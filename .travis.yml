language: php
php:
- 7.0
- 7.1
- 7.2
sudo: false
services:
- mysql
env:
  matrix:
  - SHOPWARE_VERSION="5.4"
  - SHOPWARE_VERSION="5.5"
  global:
  - PLUGIN_NAME=FroshTemplateMail
  - SHOPWARE_DIRECTORY="${HOME}/shopware"
  - PLUGIN_DIRECTORY="${SHOPWARE_DIRECTORY}/custom/plugins"
cache:
  directories:
  - "${HOME}/.composer/cache/files"
install:
- composer install
before_script:
- if [[ "$(php --version | grep -cim1 xdebug)" -ge 1 ]]; then phpenv config-rm xdebug.ini;
  fi
- git clone https://github.com/shopware/shopware.git ${SHOPWARE_DIRECTORY} --branch
  ${SHOPWARE_VERSION}
- ant -f ${SHOPWARE_DIRECTORY}/build/build.xml -Dapp.host=localhost -Ddb.user=travis
  -Ddb.host=127.0.0.1 -Ddb.name=shopware build-unit
- mv ${TRAVIS_BUILD_DIR} ${PLUGIN_DIRECTORY}/${PLUGIN_NAME}
- php ${HOME}/shopware/bin/console sw:plugin:refresh
- php ${HOME}/shopware/bin/console sw:plugin:install ${PLUGIN_NAME}
- php ${HOME}/shopware/bin/console sw:plugin:activate ${PLUGIN_NAME}
- cd ${PLUGIN_DIRECTORY}/${PLUGIN_NAME}
script:
- composer test
matrix:
  allow_failures:
  - env: SHOPWARE_VERSION="5.5"
deploy:
 skip_cleanup: true
  provider: releases
  api_key:
    secure: E7uPoqd/rGd8M6DbfcLp1a8ybJYcv3umG8eOnArJMxezAMKwGQJE96uxaRLjeOqVwwVZnZ4m6aXiHTW0EO++BK17rVtZV+xQhQzI1XCdDZDB+iHoLYm0xf3vx3G3KOO9keDGgnKtAe+AoaKBEMtsqVJRszp7FkdU5vi9kzMbmDbU27HTchyuupvuDX5XkEY7txnBF2WCQ6jFDj+CQkzo/bgXt2etVyBQr+R0UT1IMTDz+F5Bi/g2RG0Hl8p05knVvym8oMWmaKFHg5OWpXCvs/uU8IDSRAYb53ZqsAB5svhS6xGwF9nEGCgOizGhJPDGjCzByqvuWeLp7nYZZSD1UnQifc0xuLXmkz0S02gwh2LWtxCFycqC9T3vyauazapSPnDwcKQcX+vLbr+f5TtiPiYsY0ESQXVsWuSctJPqOcNeeMpmo84P+7D351Lnz4alzu+8A6aTV4B3X8vkcUARBeyhKJ0LypMSyHr/yomN83tU9FK5VWKsgAnFvd2BrI15rTNkcBhHbCgbSqMBQyWsO5sMxZxkX9Jp4VIsl/bGS0I+YROfZtRys0p0enA5j7fW2G9Abk5GpPvW8TagN/zzpG/dQLXVwsTYeXsb5Dbr/j+AwgEfQTf2NYiYkW+YvOXSFCds8jWXqlfnHemxSzXxyWPQHK5KZfXoNe1VhbrQiOg=
  file_glob: true
  file: FroshTemplateMail*.zip
  on:
    tags: true
